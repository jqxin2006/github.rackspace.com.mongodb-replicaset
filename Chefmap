{% set app_id = 'mongodb_server' %}

--- # mongodb component definition
id: mongodb
is: application
roles: [data]
provides:
- application: http
- application: ssh
requires:
- host: linux
run-list:
  recipes:
  - apt
  - mongodb::10gen_repo
  - mongodb
maps:
- source:  requirements://host:linux/private_ip
  targets:
  - outputs://instance:{{resource.index}}/instance/ip
  - outputs://instance:{{resource.index}}/instance/private_ip
  - outputs://instance:{{resource.index}}/interfaces/ssh/ip
  - outputs://instance:{{resource.index}}/interfaces/ssh/private_ip
---
id: mongodb_arbiter
is: application
roles: [arbiter]
provides:
- application: http
requires:
- host: linux
# Here are the provider settings and maps for this component
run-list:
  recipes:
  - apt
  - mongodb::10gen_repo
  - mongodb
---
id: mongdb_primary
is: application
roles: [primary]
provides:
- application: http
- application: ssh
requires:
- host: linux
run-list:
  recipes:
  - apt
  - mongodb
maps:
- source: clients://application:ssh/private_ip
  targets:
  - attributes://mongodb/replicaset_members
- source: requirements://host:linux/private_ip
  targets:
  - outputs://instance:{{resource.index}}/instance/ip
  - outputs://instance:{{resource.index}}/instance/private_ip
  - outputs://instance:{{resource.index}}/interfaces/ssh/ip
  - outputs://instance:{{resource.index}}/interfaces/ssh/private_ip
