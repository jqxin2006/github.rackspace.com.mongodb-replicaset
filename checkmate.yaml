blueprint:
  name: "MongoDB on VM"
  description: "Deploy a MongoDB replica set"
  services:
    mongodb:
      component:
        type: application
        name: mongodb
        role: data
    mongodb_arbiter:
      component:
        type: application
        name: mongodb
        role: arbiter
      constraints:
      - count: 1
      - memory: 512
  options:
    domain:
      regex: ^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$
      constrains:
      - setting: domain
        service: mongodb
        resource_type: compute
      - setting: domain
        service: mongodb_arbiter
        resource_type: compute
      description: 'The domain name to be used for the hostname of your server(s).'
      label: Domain
      sample: example.com
      type: string
      required: true
    username:
      required: true
      type: string
      default: admin
      label: Username
      description: MongoDB admin username.
    password:
      required: true
      type: string
      default: =generate_password()
      label: Password
      description: MongoDB admin password.
    server_count:
      required: true
      type: int
      default: 3
      description: Number of MongoDB data nodes.
      label: Data Nodes
      constrains:
      - setting: count
        service: mongodb
        resource_type: compute
    region:
      required: true
      type: select
      default: ORD
      label: Region
      choice:
      - DFW
      - ORD
      - LON
    os:
      constrains:
      - setting: os
        service: mongodb
        resource_type: compute
      - setting: os
        service: mongodb_arbiter
        resource_type: compute
      description: The operating system for the all servers.
      default: Ubuntu 12.04
      label: Operating System
      type: select
      choice:
      - Ubuntu 12.04
      - Ubuntu 12.10
    server_size:
      constrains:
      - setting: memory
        service: mongodb
        resource_type: compute
      description: The size of the database instances in MB of RAM.
      default: 512
      label: Server Size
      type: select
      choice:
      - name: 512 Mb
        value: 512
      - name: 1 Gb
        value: 1024
      - name: 2 Gb
        value: 2048
      - name: 4 Gb
        value: 4096
      - name: 8 Gb
        value: 8092
      - name: 16 Gb
        value: 16384
      - name: 30 Gb
        value: 30720
environment:
  description: This environment uses next-gen cloud servers.
  name: Next-Gen Open Cloud
  providers:
    chef-solo:
      provides:
      - application: mongodb 
      - compute: mongodb
      vendor: opscode
      constraints:
      - source: %repo_url%
    nova: {}
    common:
      vendor: rackspace
inputs:
  blueprint:
    region: ORD
    server_size: 1024
